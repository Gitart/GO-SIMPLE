## Что такое веб-токен JSON?

JSON Web Token (JWT) - это открытый стандарт ( [RFC 7519](https://tools.ietf.org/html/rfc7519) ), который определяет компактный и автономный способ безопасной передачи информации между сторонами в виде объекта JSON. Эту информацию можно проверить и доверять, потому что она имеет цифровую подпись. JWT могут быть подписаны с использованием секрета (с помощью алгоритма **HMAC** ) или пары открытого / закрытого ключей с использованием **RSA** или **ECDSA** .

Хотя JWT могут быть зашифрованы для обеспечения секретности между сторонами, мы сосредоточимся на *подписанных* токенах. Подписанные токены могут проверять *целостность* содержащихся в них утверждений, в то время как зашифрованные токены *скрывают* эти утверждения от других сторон. Когда токены подписываются с использованием пар открытого / закрытого ключей, подпись также удостоверяет, что только сторона, владеющая закрытым ключом, является той, которая его подписала.

## Когда следует использовать веб-токены JSON?

Вот несколько сценариев, в которых полезны веб-токены JSON:

*   **Авторизация** : это наиболее распространенный сценарий использования JWT. После того, как пользователь вошел в систему, каждый последующий запрос будет включать JWT, позволяя пользователю получать доступ к маршрутам, службам и ресурсам, разрешенным с помощью этого токена. Единый вход - это функция, которая в настоящее время широко использует JWT из-за ее небольших накладных расходов и ее способности легко использоваться в разных доменах.

*   **Обмен информацией** : веб-токены JSON - хороший способ безопасной передачи информации между сторонами. Поскольку JWT могут быть подписаны, например, с использованием пар открытого / закрытого ключей, вы можете быть уверены, что отправители являются теми, кем они себя называют. Кроме того, поскольку подпись рассчитывается с использованием заголовка и полезной нагрузки, вы также можете убедиться, что содержимое не было изменено.

## Какова структура веб-токена JSON?

В своей компактной форме веб-токены JSON состоят из трех частей, разделенных точками ( `.` ), а именно:

*   Заголовок
*   Полезная нагрузка
*   Подпись

Поэтому JWT обычно выглядит следующим образом.

`xxxxx.yyyyy.zzzzz`

Давайте разберем разные части.

### Заголовок

Заголовок *обычно* состоит из двух частей: типа токена, которым является JWT, и используемого алгоритма подписи, такого как HMAC SHA256 или RSA.

Например:

```
{
  "alg": "HS256",
  "typ": "JWT"
}

```

Затем этот JSON закодирован в **Base64Url,** чтобы сформировать первую часть JWT.

### Полезная нагрузка

Вторая часть токена - это полезная нагрузка, содержащая утверждения. Утверждения - это утверждения о сущности (обычно, о пользователе) и дополнительных данных. Есть три типа требований: *зарегистрированные* , *публичные* и *частные* .

*   [**Зарегистрированные претензии**](https://tools.ietf.org/html/rfc7519#section-4.1) : это набор предопределенных претензий, которые не являются обязательными, но рекомендуются для предоставления набора полезных, совместимых претензий. Вот некоторые из них: **iss** (эмитент), **exp** (срок действия), **sub** (тема), **aud** (аудитория) и [другие](https://tools.ietf.org/html/rfc7519#section-4.1) .

    > Обратите внимание, что имена утверждений состоят всего из трех символов, поскольку JWT должен быть компактным.

*   [**Публичные утверждения**](https://tools.ietf.org/html/rfc7519#section-4.2) : они могут быть определены по желанию теми, кто использует JWT. Но во избежание коллизий они должны быть определены в [реестре веб-токенов IANA JSON](https://www.iana.org/assignments/jwt/jwt.xhtml) или определены как URI, содержащий пространство имен, устойчивое к коллизиям.

*   [**Частные претензии**](https://tools.ietf.org/html/rfc7519#section-4.3) : это настраиваемые претензии, созданные для обмена информацией между сторонами, которые соглашаются их использовать, и не являются *зарегистрированными* или *публичными* претензиями.

Примером полезной нагрузки может быть:

```
{
  "sub": "1234567890",
  "name": "John Doe",
  "admin": true
}

```

Затем полезная **нагрузка** кодируется **Base64Url,** чтобы сформировать вторую часть веб-токена JSON.

> Обратите внимание, что для подписанных токенов эта информация, хотя и защищена от подделки, доступна для чтения кем угодно. Не помещайте секретную информацию в элементы полезной нагрузки или заголовка JWT, если она не зашифрована.

### Подпись

Чтобы создать часть подписи, вы должны взять закодированный заголовок, закодированную полезную нагрузку, секрет, алгоритм, указанный в заголовке, и подписать его.

Например, если вы хотите использовать алгоритм HMAC SHA256, подпись будет создана следующим образом:

```
HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret)

```

Подпись используется для проверки того, что сообщение не было изменено в процессе, и в случае токенов, подписанных закрытым ключом, она также может проверить, что отправитель JWT является тем, кем он является.

### Собираем все вместе

Результатом являются три строки URL-адреса Base64, разделенные точками, которые можно легко передать в средах HTML и HTTP, но при этом они более компактны по сравнению со стандартами на основе XML, такими как SAML.

Ниже показан JWT, в котором закодированы предыдущий заголовок и полезная нагрузка, и он подписан секретом. ![Закодированный JWT](https://cdn.auth0.com/content/jwt/encoded-jwt3.png)

Если вы хотите поиграть с JWT и применить эти концепции на практике, вы можете использовать [jwt.io Debugger](https://jwt.io/#debugger-io) для декодирования, проверки и генерации JWT.

![Отладчик JWT.io](https://cdn.auth0.com/blog/legacy-app-auth/legacy-app-auth-5.png)

## Как работают веб-токены JSON?

При аутентификации, когда пользователь успешно входит в систему, используя свои учетные данные, будет возвращен веб-токен JSON. Поскольку токены являются учетными данными, необходимо проявлять большую осторожность, чтобы предотвратить проблемы с безопасностью. В общем, вы не должны хранить токены дольше, чем требуется.

Вы также [не должны хранить конфиденциальные данные сеанса в хранилище браузера из-за недостаточной безопасности](https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#local-storage) .

Всякий раз, когда пользователь хочет получить доступ к защищенному маршруту или ресурсу, пользовательский агент должен отправить JWT, обычно в заголовке **авторизации** с использованием схемы **Bearer** . Содержание заголовка должно выглядеть следующим образом:

```
Authorization: Bearer <token>

```

В некоторых случаях это может быть механизм авторизации без сохранения состояния. Защищенные маршруты сервера будут проверять наличие допустимого JWT в `Authorization` заголовке, и если он присутствует, пользователю будет разрешен доступ к защищенным ресурсам. Если JWT содержит необходимые данные, потребность в запросе базы данных для определенных операций может быть уменьшена, хотя это не всегда так.

Если токен отправляется в `Authorization` заголовке, совместное использование ресурсов между источниками (CORS) не будет проблемой, поскольку оно не использует файлы cookie.

На следующей диаграмме показано, как JWT получается и используется для доступа к API или ресурсам:

![Как работает веб-токен JSON](https://cdn2.auth0.com/docs/media/articles/api-auth/client-credentials-grant.png)

1.  Приложение или клиент запрашивает авторизацию у сервера авторизации. Это выполняется через один из разных потоков авторизации. Например, типичное веб-приложение, совместимое с [OpenID Connect,](http://openid.net/connect/) будет проходить через `/oauth/authorize` конечную точку с использованием [потока кода авторизации](http://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth) .
2.  Когда авторизация предоставлена, сервер авторизации возвращает токен доступа приложению.
3.  Приложение использует токен доступа для доступа к защищенному ресурсу (например, API).

Обратите внимание, что с подписанными токенами вся информация, содержащаяся в токене, предоставляется пользователям или другим сторонам, даже если они не могут ее изменить. Это означает, что вы не должны помещать в токен секретную информацию.

## Почему мы должны использовать веб-токены JSON?

Давайте поговорим о преимуществах **веб-токенов JSON (JWT)** по сравнению с **простыми веб-токенами (SWT)** и **токенами языка разметки утверждения безопасности (SAML)** .

Поскольку JSON менее подробен, чем XML, при кодировании его размер также меньше, что делает JWT более компактным, чем SAML. Это делает JWT хорошим выбором для передачи в средах HTML и HTTP.

С точки зрения безопасности SWT может быть симметрично подписан общим секретом только с использованием алгоритма HMAC. Однако токены JWT и SAML могут использовать пару открытого / закрытого ключей в форме сертификата X.509 для подписи. Подписание XML с помощью цифровой подписи XML без появления скрытых дыр в безопасности очень сложно по сравнению с простотой подписания JSON.

Парсеры JSON распространены в большинстве языков программирования, потому что они напрямую отображаются на объекты. И наоборот, XML не имеет естественного преобразования документа в объект. Это упрощает работу с JWT, чем с утверждениями SAML.

Что касается использования, JWT используется в масштабе Интернета. Это подчеркивает простоту обработки веб-токена JSON на стороне клиента на нескольких платформах, особенно на мобильных.

![Сравнение длины закодированного JWT и закодированного SAML](https://cdn.auth0.com/content/jwt/comparing-jwt-vs-saml2.png) *Сравнение длины закодированного JWT и закодированного SAML*

Если вы хотите узнать больше о веб-токенах JSON и даже начать использовать их для аутентификации в своих приложениях, перейдите на [целевую страницу веб-токенов JSON по](http://auth0.com/learn/json-web-tokens) адресу Auth0.
