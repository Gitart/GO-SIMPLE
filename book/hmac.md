# Код аутентификации сообщений на основе хэша (HMAC)

Основанные на хэше MAC (HMAC) принимают длинное сообщение в качестве входных данных и создают выход фиксированной длины. В этой схеме отправитель подписывает сообщение, используя MAC, а получатель проверяет его, используя общий ключ. Он хэширует ключ с сообщением, используя один из двух методов, известных как секретный префикс (ключ идет первым, а сообщение приходит позже), или секретный суффикс (ключ идет после сообщения).

---

## Высокоуровневый дизайн HMAC

Код проверки подлинности сообщения (MAC) \- это небольшая часть информации или небольшой алгоритм, в основном используемый для проверки подлинности сообщения и обеспечения целостности и гарантий подлинности сообщения. Код аутентификации сообщения на основе хеша \- это код аутентификации сообщения, полученный из криптографической хеш\-функции, такой как MD5 и SHA\-1. Основная идея HMAC \- добавить слой с использованием секретного ключа в существующие алгоритмы дайджеста сообщений. Даже если злоумышленник получит базу данных хэшированных паролей с солями, им все равно будет трудно взломать их без секретного ключа. Поскольку алгоритмы, такие как MD5 и SHA\-1, не полагаются на секретный ключ, HMAC был выбран в качестве обязательного для реализации MAC для безопасности IP. HMAC может работать с любыми существующими алгоритмами дайджеста сообщений (хеш\-функциями). Он рассматривает дайджест сообщения, созданного встроенной хэш\-функцией, как черный ящик. Затем он использует общий симметричный ключ для шифрования дайджеста сообщения, таким образом, получая окончательный результат, то есть MAC. HMAC \- это расчет MAC с использованием криптографической хэш\-функции, такой как MD5 или SHA\-1.

Когда мы используем SHA\-1, соответствующий MAC будет известен как HMAC\-SHA1, или, если используется SHA\-2, мы скажем HMAC\-SHA256. Рекомендуется хранить секретный ключ в отдельном месте, например в переменной среды, а не в базе данных с хешированными паролями и солями.

---

## HMAC в Go

Этот пример имеет ограниченное использование. Используйте его как ссылку для ваших собственных приложений.

```go
package main
  
import (
    "crypto/hmac"
    "crypto/rand"
    "crypto/sha256"
    "crypto/sha512"
    "encoding/base64"
    "fmt"
    "io"
)
  
var secretKey = "4234kxzjcjj3nxnxbcvsjfj"
  
// Generate a salt string with 16 bytes of crypto/rand data.
func generateSalt() string {
    randomBytes := make([]byte, 16)
    _, err := rand.Read(randomBytes)
    if err != nil {
        return ""
    }
    return base64.URLEncoding.EncodeToString(randomBytes)
}
  
func main() {
    message := "Today web engineering has modern apps adhere to what is known as a single-page app (SPA) model."
    salt := generateSalt()
    fmt.Println("Message: " + message)
    fmt.Println("\nSalt: " + salt)
  
    hash := hmac.New(sha256.New, []byte(secretKey))
    io.WriteString(hash, message+salt)
    fmt.Printf("\nHMAC-Sha256: %x", hash.Sum(nil))
  
    hash = hmac.New(sha512.New, []byte(secretKey))
    io.WriteString(hash, message+salt)
    fmt.Printf("\n\nHMAC-sha512: %x", hash.Sum(nil))
}
```
