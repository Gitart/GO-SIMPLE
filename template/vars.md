# Введение в Гюго

Хьюго использует Go `html/template` и `text/template` библиотеки в качестве основы для шаблонов.

Следующее \- только учебник по Го шаблонам. Для подробного изучения шаблонов Go ознакомьтесь с официальными [документами Go](https://golang.org/pkg/text/template/) .

Шаблоны Go предоставляют чрезвычайно простой язык шаблонов, который придерживается убеждения, что только базовая логика принадлежит слою шаблонов или представлений.

## Основной синтаксис[](#basic-syntax)

Шаблоны Go \- это HTML\-файлы с добавлением [переменных](https://gohugo.io/variables/ "См. Полный объем страниц, сайтов и других переменных, которые Хьюго делает доступными для вас в ваших шаблонах.") и [функций](https://gohugo.io/functions/ "См. Полный список шаблонных функций Hugo с кратким справочным руководством и базовыми и расширенными примерами.") . Перейти Шаблонные переменные и функции доступны внутри `{{ }}` .

### Доступ к предопределенной переменной[](#access-a-predefined-variable)

*Предопределенной переменной* может быть переменной , уже существующие в текущей области (подобно , `.Title` например , в [переменных](#variables) разделе ниже) или пользовательской переменной (как , `$address` например , в том же разделе).

```go-html-template
{{ .Title }}
{{ $address }}

```

Параметры для функций разделяются пробелами. Общий синтаксис:

```
{{ FUNCTION ARG1 ARG2 .. }}

```

В следующем примере вызывается `add` функция с входами `1` и `2` :

```go-html-template
{{ add 1 2 }}

```

#### Методы и поля доступны через точечную нотацию[](#methods-and-fields-are-accessed-via-dot-notation)

Доступ к параметру страницы, `bar` определенному в части [материала](https://gohugo.io/content-management/front-matter/) .

```go-html-template
{{ .Params.bar }}

```

#### Круглые скобки могут использоваться для группировки элементов[](#parentheses-can-be-used-to-group-items-together)

```go-html-template
{{ if or (isset .Params "alt") (isset .Params "caption") }} Caption {{ end }}

```

## переменные[](#variables)

Каждый шаблон Go получает объект данных. В Hugo каждый шаблон передается `Page` . В приведенном ниже примере `.Title` это один из элементов, доступных в этой [`Page`переменной](https://gohugo.io/variables/page/) .

Поскольку `Page` область шаблона является областью по умолчанию, `Title` элемент в текущей области ( `.` \- « **точка** ») доступен просто через префикс\-точка ( `.Title` ):

```go-html-template
<title>{{ .Title }}</title>

```

Значения также могут храниться в пользовательских переменных и ссылаться позже:

Пользовательские переменные должны иметь префикс `$` .

```go-html-template
{{ $address := "123 Main St." }}
{{ $address }}

```

Для Hugo v0.47 и более ранних версий переменные, определенные внутри `if` условных и аналогичных элементов , не видны снаружи. См. [Https://github.com/golang/go/issues/10608](https://github.com/golang/go/issues/10608) .

Хьюго создал обход этой проблемы в [Scratch](https://gohugo.io/functions/scratch) .

Для **Hugo v0.48** и новее переменные могут быть переопределены с помощью `=` оператора new (new в Go 1.11).

Приведенный ниже пример будет работать только в этих новых версиях Hugo. Пример печатает «Var is Hugo Home» на домашней странице и «Var is Hugo Page» на всех других страницах:

```go-html-template
{{ $var := "Hugo Page" }}
{{ if .IsHome }}
    {{ $var = "Hugo Home" }}
{{ end }}
Var is {{ $var }}

```

## функции[](#functions)

Шаблоны Go поставляются только с несколькими базовыми функциями, но также предоставляют механизм для приложений, расширяющих исходный набор.

[Шаблонные функции Hugo](https://gohugo.io/functions/ "См. Полный список шаблонных функций Hugo с кратким справочным руководством и базовыми и расширенными примерами.") предоставляют дополнительные функции, характерные для создания веб\-сайтов. Функции вызываются по имени, за которым следуют обязательные параметры, разделенные пробелами. Функции шаблона не могут быть добавлены без перекомпиляции Hugo.

### Пример 1: Добавление чисел[](#example-1-adding-numbers)

```go-html-template
{{ add 1 2 }}
<!-- prints 3 -->

```

### Пример 2: сравнение чисел[](#example-2-comparing-numbers)

```go-html-template
{{ lt 1 2 }}
<!-- prints true (i.e., since 1 is less than 2) -->

```

Обратите внимание, что оба примера используют [математические функции](https://gohugo.io/functions/math/) Go Template .

Существует больше логических операторов, чем указано в документации Гуго в документации по шаблону [Go](https://golang.org/pkg/text/template/#hdr-Functions) .

## Включает[](#includes)

При включении другого шаблона вам нужно будет передать ему данные, к которым он должен был бы получить доступ.

Чтобы передать текущий контекст, не забудьте добавить конечную **точку** .

Расположение шаблонов всегда будет начинаться с `layouts/` каталога в Hugo.

### частичный[](#partial)

[`partial`](https://gohugo.io/templates/partials/ "Ссылка на страницу с частичными шаблонами внутри разделов шаблонов документов Hugo.") Функция используется для включения *частичных* шаблонов с использованием синтаксиса `{{ partial "<PATH>/<PARTIAL>.<EXTENSION>" . }}` .

Пример включения `layouts/partials/header.html` частичного:

```go-html-template
{{ partial "header.html" . }}

```

### шаблон[](#template)

`template` Функция использовалась для включения *частичных* шаблонов в более старых версиях Гюго. Теперь это полезно только для вызова [*внутренних* шаблонов](https://gohugo.io/templates/internal/) . Синтаксис есть `{{ template "_internal/<TEMPLATE>.<EXTENSION>" . }}` .

Доступные **внутренние** шаблоны можно найти [здесь](https://github.com/gohugoio/hugo/tree/master/tpl/tplimpl/embedded/templates) .

Пример включения внутреннего `opengraph.html` шаблона:

```go-html-template
{{ template "_internal/opengraph.html" . }}

```

## логика[](#logic)

Шаблоны Go предоставляют самую базовую итерацию и условную логику.

### итерация[](#iteration)

Шаблоны Go активно используются `range` для итерации по *карте* , *массиву* или *фрагменту* . Ниже приведены различные примеры использования `range` .

#### Пример 1. Использование Context ( `.` )[](#example-1-using-context-)

```go-html-template
{{ range $array }}
    {{ . }} <!-- The . represents an element in $array -->
{{ end }}

```

#### Пример 2: Объявление имени переменной для значения элемента массива[](#example-2-declaring-a-variable-name-for-an-array-elements-value)

```go-html-template
{{ range $elem_val := $array }}
    {{ $elem_val }}
{{ end }}

```

#### Пример 3: Объявление имен переменных для индекса *и* значения элемента массива[](#example-3-declaring-variable-names-for-an-array-elements-index-_and_-value)

Для массива или фрагмента первая объявленная переменная будет отображаться в индекс каждого элемента.

```go-html-template
{{ range $elem_index, $elem_val := $array }}
   {{ $elem_index }} -- {{ $elem_val }}
{{ end }}

```

#### Пример 4: Объявление имен переменных для ключа *и* значения элемента карты[](#example-4-declaring-variable-names-for-a-map-elements-key-_and_-value)

Для карты первая объявленная переменная будет сопоставлена ​​с ключом каждого элемента карты.

```go-html-template
{{ range $elem_key, $elem_val := $map }}
   {{ $elem_key }} -- {{ $elem_val }}
{{ end }}

```

#### Пример 5: Условно на пустой *карте* , *массиве* или *фрагменте* .[](#example-5-conditional-on-empty-_map_-_array_-or-_slice_)

Если *карта* , *массив* или *фрагмент,* переданные в диапазон, имеют нулевую длину, тогда выполняется оператор else.

```go-html-template
{{ range $array }}
    {{ . }}
{{else}}
    <!-- This is only evaluated if $array is empty -->
{{ end }}

```

### Conditionals[](#conditionals)

`if` , `else` , `with` , `or` , И `and` обеспечивают основу для обработки условной логики в Go шаблонах. Мол `range` , каждое утверждение закрывается с `{{ end }}` .

Шаблоны Go обрабатывают следующие значения как **ложные** :

*   `false` (Булево)
*   0 (целое число)
*   любой массив нулевой длины, фрагмент, карта или строка

#### Пример 1: `with`[](#example-1-with)

Обычно пишут заявления типа «если что\-то существует, делай это» `with` .

`with` перепривязывает контекст `.` в своей области (как в `range` ).

Он пропускает блок, если переменная отсутствует или оценивается как «ложная», как объяснено выше.

```go-html-template
{{ with .Params.title }}
    <h4>{{ . }}</h4>
{{ end }}

```

#### Пример 2: `with` .. `else`[](#example-2-with--else)

В приведенном ниже фрагменте используется значение параметра переднего вопроса «description», если оно установлено, иначе используется `.Summary` [переменная Page](https://gohugo.io/variables/page/) по умолчанию :

```go-html-template
{{ with .Param "description" }}
    {{ . }}
{{ else }}
    {{ .Summary }}
{{ end }}

```

Смотрите [`.Param`функцию](https://gohugo.io/functions/param/) .

#### Пример 3: `if`[](#example-3-if)

Альтернативный (и более подробный) способ написания `with` использует `if` . Здесь, `.` не получает rebinded.

Ниже пример «Пример 1» переписан с использованием `if` :

```go-html-template
{{ if isset .Params "title" }}
    <h4>{{ index .Params "title" }}</h4>
{{ end }}

```

#### Пример 4: `if` .. `else`[](#example-4-if--else)

Ниже приведен пример «Пример 2», переписанный с использованием `if` .. `else` и взамен использующий [`isset`функцию](https://gohugo.io/functions/isset/) \+ `.Params` переменную (отличную от [`.Param` **функции**](https://gohugo.io/functions/param/) ):

```go-html-template
{{ if (isset .Params "description") }}
    {{ index .Params "description" }}
{{ else }}
    {{ .Summary }}
{{ end }}

```

#### Пример 5: `if` .. `else if` .. `else`[](#example-5-if--else-if--else)

В отличие от `with` , `if` может содержать и `else if` предложения.

```go-html-template
{{ if (isset .Params "description") }}
    {{ index .Params "description" }}
{{ else if (isset .Params "summary") }}
    {{ index .Params "summary" }}
{{ else }}
    {{ .Summary }}
{{ end }}

```

#### Пример 6: `and` & `or`[](#example-6-and--or)

```go-html-template
{{ if (and (or (isset .Params "title") (isset .Params "caption")) (isset .Params "attr")) }}

```

## трубы[](#pipes)

Одним из наиболее мощных компонентов шаблонов Go является возможность составлять действия один за другим. Это делается с помощью труб. Заимствованная из каналов Unix, концепция проста: выход каждого конвейера становится входом следующего канала.

Из\-за очень простого синтаксиса шаблонов Go, канал необходим для возможности связывать воедино вызовы функций. Одно ограничение каналов состоит в том, что они могут работать только с одним значением, и это значение становится последним параметром следующего конвейера.

Несколько простых примеров должны помочь понять, как использовать трубу.

### Пример 1: `shuffle`[](#example-1-shuffle)

Следующие два примера функционально одинаковы:

```go-html-template
{{ shuffle (seq 1 5) }}

```

```go-html-template
{{ (seq 1 5) | shuffle }}

```

### Пример 2: `index`[](#example-2-index)

Следующее получает доступ к параметру страницы с именем «disqus\_url» и экранирует HTML. В этом примере также используется [`index`функция](https://gohugo.io/functions/index/) , встроенная в шаблоны Go:

```go-html-template
{{ index .Params "disqus_url" | html }}

```

### Пример 3: `or` с `isset`[](#example-3-or-with-isset)

```go-html-template
{{ if or (or (isset .Params "title") (isset .Params "caption")) (isset .Params "attr") }}
Stuff Here
{{ end }}

```

Может быть переписан как

```go-html-template
{{ if isset .Params "caption" | or isset .Params "title" | or isset .Params "attr" }}
Stuff Here
{{ end }}

```

### Пример 4: условные комментарии Internet Explorer[](#ie-conditional-comments)

По умолчанию шаблоны Go удаляют комментарии HTML из вывода. Это имеет неприятный побочный эффект удаления условных комментариев Internet Explorer. В качестве обходного пути используйте что\-то вроде этого:

```go-html-template
{{ "<!--[if lt IE 9]>" | safeHTML }}
  <script src="html5shiv.js"></script>
{{ "<![endif]-->" | safeHTML }}

```

В качестве альтернативы вы можете использовать backtick ( `` ` `` ) для цитирования условных комментариев IE, избегая утомительной задачи экранирования каждых двойных кавычек ( `"` ) внутри, как показано в [примерах](https://golang.org/pkg/text/template/#hdr-Examples) в текстовой / шаблонной документации Go:

```go-html-template
{{ `<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]-->` | safeHTML }}

```

## Контекст (он же «точка»)[](#the-dot)

Самая легко пропускаемая концепция для понимания шаблонов Go \- это то, что `{{ . }}` всегда относится к **текущему контексту** .

*   На верхнем уровне вашего шаблона это будет набор данных, сделанный доступным для него.
*   Однако внутри итерации будет иметь значение текущего элемента в цикле; т.е. `{{ . }}` больше не будет ссылаться на данные, доступные для всей страницы.

Если вам необходимо получить доступ к данным на уровне страницы (например, к параметрам страницы, заданным в начале) из цикла, вы, вероятно, захотите выполнить одно из следующих действий:

### 1\. Определите переменную, независимую от контекста[](#1-define-a-variable-independent-of-context)

Ниже показано, как определить переменную, независимую от контекста.

Теги\-диапазон с страницами\-variable.html

```go-html-template

{{ $title := .Site.Title }}
<ul>
{{ range .Params.tags }}
    <li>
        <a href="/tags/{{ . | urlize }}">{{ . }}</a>
        - {{ $title }}
    </li>
{{ end }}
</ul>

```

Обратите внимание, как только мы вошли в цикл (то есть `range` ), значение `{{ . }}` изменилось. Мы определили переменную вне цикла ( `{{$title}}` ), которой мы присвоили значение, чтобы у нас также был доступ к значению внутри цикла.

### 2\. Используйте `$.` для доступа к глобальному контексту[](#2-use--to-access-the-global-context)

`$` имеет особое значение в ваших шаблонах. по умолчанию `$` установлено начальное значение `.` («точка»). Это [документированная особенность текста / шаблона Go](https://golang.org/pkg/text/template/#hdr-Variables) . Это означает, что у вас есть доступ к глобальному контексту из любой точки мира. Вот эквивалентный пример предыдущего блока кода, но теперь используется `$` для извлечения `.Site.Title` из глобального контекста:

Диапазон сквозных\-тегов\-ш\-global.html

```go-html-template

<ul>
{{ range .Params.tags }}
  <li>
    <a href="/tags/{{ . | urlize }}">{{ . }}</a>
            - {{ $.Site.Title }}
  </li>
{{ end }}
</ul>

```

Встроенная магия `$` перестала бы работать, если бы кто\-то дурно переопределил специальный символ; например `{{ $ := .Site }}` . *Не делай этого.* Вы, конечно, можете оправиться от этого вреда, используя `{{ $ := . }}` в глобальном контексте для сброса `$` его значение по умолчанию.

## Пробелы[](#whitespace)

Go 1.6 включает в себя возможность обрезать пропуски с любой стороны тега Go, включая дефис ( `-` ) и пробел непосредственно рядом с соответствующим `{{` или `}}` разделителем.

Например, следующий шаблон Go будет включать в свой вывод HTML строки новой строки и горизонтальную вкладку:

```go-html-template
<div>
  {{ .Title }}
</div>

```

Который будет выводить:

```html
<div>
  Hello, World!
</div>

```

Использование `-` в следующем примере удалит лишние пробелы, окружающие `.Title` переменную, и удалит новую строку:

```go-html-template
<div>
  {{- .Title -}}
</div>

```

Который затем выводит:

```html
<div>Hello, World!</div>

```

Go рассматривает следующие символы *пробела* :

*   Космос
*   горизонтальная вкладка
*   возврат каретки
*   новая линия

## Комментарии[](#comments)

Чтобы ваши шаблоны были организованы и обменивались информацией со всей командой, вы можете добавлять комментарии к своим шаблонам. Есть два способа сделать это с Хьюго.

### Перейти Шаблоны комментариев[](#go-templates-comments)

Перейти Поддержка шаблонов `{{/*` и `*/}}` открыть и закрыть блок комментариев. Ничто в этом блоке не будет отображено.

Например:

```go-html-template
Bonsoir, {{/* {{ add 0 + 2 }} */}}Eliott.

```

Будет отображаться `Bonsoir, Eliott.` , и не заботиться о синтаксической ошибке ( `add 0 + 2` ) в блоке комментариев.

### HTML комментарии[](#html-comments)

Если вам нужно создать HTML\-комментарии из ваших шаблонов, взгляните на пример [условных комментариев](#ie-conditional-comments) в [Internet Explorer](#ie-conditional-comments) . Если вам нужно переменные для построения таких HTML комментариев, только трубы `printf` к `safeHTML` . Например:

```go-html-template
{{ printf "<!-- Our website is named: %s -->" .Site.Title | safeHTML }}

```

#### HTML\-комментарии, содержащие шаблоны Go[](#html-comments-containing-go-templates)

HTML\-комментарии по умолчанию удаляются, но их содержание по\-прежнему оценивается. Это означает, что, хотя HTML\-комментарий никогда не будет отображать какой\-либо контент на конечных HTML\-страницах, код, содержащийся в комментарии, может не сработать.

Вы **не** попробовать закомментировать код Go шаблона , используя HTML комментарии.

```go-html-template
<!-- {{ $author := "Emma Goldman" }} was a great woman. -->
{{ $author }}

```

Механизм шаблонов удалит содержимое комментария HTML, но сначала оценит любой код шаблона Go, если он присутствует внутри. Таким образом, приведенный выше пример будет отображаться `Emma Goldman` как `$author` переменная, полученная в комментарии HTML. Но сборка не состоялась бы, если бы этот код в комментарии HTML содержал ошибку.
